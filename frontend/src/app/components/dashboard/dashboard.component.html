<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1>ğŸš• NYC TLC Trip Analytics</h1>
      <p class="subtitle">Real-time insights from 5 years of NYC taxi data</p>
    </div>
    <button class="btn-logout" (click)="logout()">
      <span>ğŸ‘¤</span> Logout
    </button>
  </header>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label>ğŸ“… Start Date</label>
      <input 
        type="date" 
        [(ngModel)]="startDate" 
        (change)="onFilterChange()"
      />
    </div>

    <div class="filter-group">
      <label>ğŸ“… End Date</label>
      <input 
        type="date" 
        [(ngModel)]="endDate" 
        (change)="onFilterChange()"
      />
    </div>

    <div class="filter-group">
      <label>ğŸš– Service Type</label>
      <select [(ngModel)]="serviceType" (change)="onFilterChange()">
        <option value="">All Services</option>
        <option value="yellow">Yellow Taxi</option>
        <option value="green">Green Taxi</option>
        <option value="fhv">FHV</option>
        <option value="fhvhv">FHVHV</option>
      </select>
    </div>

    <button class="btn-primary" (click)="loadData()">
      ğŸ”„ Refresh
    </button>
    
    <button class="btn-export" (click)="exportData()" *ngIf="aggregates.length > 0">
      ğŸ“Š Export CSV
    </button>
  </div>

  <!-- Summary Cards -->
  <div class="summary-section" *ngIf="summary && !loadingSummary">
    <div class="summary-card card-trips">
      <div class="card-icon">ğŸš•</div>
      <div class="card-content">
        <div class="card-value">{{ summary.total_trips | number }}</div>
        <div class="card-label">Total Trips</div>
      </div>
    </div>

    <div class="summary-card card-revenue">
      <div class="card-icon">ğŸ’°</div>
      <div class="card-content">
        <div class="card-value">{{ summary.total_revenue | currency:'USD':'symbol':'1.0-0' }}</div>
        <div class="card-label">Total Revenue</div>
      </div>
    </div>

    <div class="summary-card card-distance">
      <div class="card-icon">ğŸ›£ï¸</div>
      <div class="card-content">
        <div class="card-value">{{ summary.avg_distance | number:'1.1-1' }} mi</div>
        <div class="card-label">Avg Distance</div>
      </div>
    </div>

    <div class="summary-card card-duration">
      <div class="card-icon">â±ï¸</div>
      <div class="card-content">
        <div class="card-value">{{ summary.avg_duration_minutes | number:'1.0-0' }} min</div>
        <div class="card-label">Avg Duration</div>
      </div>
    </div>

    <div class="summary-card card-fare">
      <div class="card-icon">ğŸ’µ</div>
      <div class="card-content">
        <div class="card-value">{{ summary.avg_fare | currency }}</div>
        <div class="card-label">Avg Fare</div>
      </div>
    </div>
  </div>

  <!-- Loading skeleton for summary -->
  <div class="summary-section" *ngIf="loadingSummary">
    <div class="summary-card skeleton">
      <div class="skeleton-loader"></div>
    </div>
    <div class="summary-card skeleton">
      <div class="skeleton-loader"></div>
    </div>
    <div class="summary-card skeleton">
      <div class="skeleton-loader"></div>
    </div>
    <div class="summary-card skeleton">
      <div class="skeleton-loader"></div>
    </div>
    <div class="summary-card skeleton">
      <div class="skeleton-loader"></div>
    </div>
  </div>

  <!-- Charts Grid -->
  <div class="charts-grid">
    <!-- Trip Volume Time Series -->
    <div class="chart-section chart-wide">
      <div class="section-header">
        <h2>ğŸ“ˆ {{ chartTitle }}</h2>
      </div>
      <div class="chart-container" *ngIf="!loadingChart && aggregates.length > 0">
        <canvas 
          baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          [type]="lineChartType"
        ></canvas>
      </div>
      <div class="skeleton-chart" *ngIf="loadingChart">
        <div class="skeleton-loader"></div>
      </div>
      <div class="empty-state" *ngIf="!loadingChart && aggregates.length === 0">
        <p>ğŸ“Š No data available</p>
        <small>Try adjusting your date range or filters</small>
      </div>
    </div>

    <!-- Service Type Distribution -->
    <div class="chart-section">
      <div class="section-header">
        <h2>ğŸ¯ Service Type Distribution</h2>
      </div>
      <div class="chart-container chart-pie" *ngIf="!loadingSummary && summary && summary.by_service_type.length > 0">
        <canvas 
          baseChart
          [data]="pieChartData"
          [options]="pieChartOptions"
          [type]="pieChartType"
        ></canvas>
      </div>
      <div class="skeleton-chart" *ngIf="loadingSummary">
        <div class="skeleton-loader"></div>
      </div>
    </div>

    <!-- Revenue Chart -->
    <div class="chart-section">
      <div class="section-header">
        <h2>ğŸ’µ {{ revenueChartTitle }}</h2>
      </div>
      <div class="chart-container" *ngIf="!loadingChart && aggregates.length > 0">
        <canvas 
          baseChart
          [data]="revenueChartData"
          [options]="revenueChartOptions"
          [type]="revenueChartType"
        ></canvas>
      </div>
      <div class="skeleton-chart" *ngIf="loadingChart">
        <div class="skeleton-loader"></div>
      </div>
    </div>
  </div>

  <!-- Trip Records Table -->
  <div class="table-section">
    <div class="section-header">
      <h2>ğŸ“‹ Trip Records</h2>
      <span class="record-count" *ngIf="totalRecords > 0">
        {{ totalRecords | number }} records
      </span>
    </div>
    
    <div class="loading-overlay" *ngIf="loadingTable">
      <div class="spinner"></div>
      <p>Loading trip records...</p>
    </div>
    
    <div *ngIf="!loadingTable && trips.length === 0 && !tripError" class="empty-state">
      <p>ğŸ“­ No trip records found</p>
      <small>Try adjusting your date range or removing filters.</small>
    </div>
    
    <div *ngIf="tripError && !loadingTable" class="alert-warning">
      <strong>âš ï¸ Unable to load trip records.</strong> {{ tripError }}
    </div>

    <div *ngIf="!loadingTable && trips.length > 0" class="table-wrapper">
      <table class="trips-table">
        <thead>
          <tr>
            <th>Trip ID</th>
            <th>Service</th>
            <th>Pickup Time</th>
            <th>Pickup Location</th>
            <th>Dropoff Location</th>
            <th>Distance</th>
            <th>Duration</th>
            <th>Fare</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trip of trips" class="trip-row">
            <td><span class="trip-id">{{ trip.trip_id }}</span></td>
            <td>
              <span class="badge" [class]="'badge-' + trip.service_type">
                {{ trip.service_type.toUpperCase() }}
              </span>
            </td>
            <td class="datetime">{{ trip.pickup_datetime | date:'MMM d, h:mm a' }}</td>
            <td class="location">
              <strong>{{ trip.pickup_borough || 'Unknown' }}</strong><br>
              <small>{{ trip.pickup_zone || 'N/A' }}</small>
            </td>
            <td class="location">
              <strong>{{ trip.dropoff_borough || 'Unknown' }}</strong><br>
              <small>{{ trip.dropoff_zone || 'N/A' }}</small>
            </td>
            <td class="metric">{{ trip.trip_distance | number:'1.2-2' }} mi</td>
            <td class="metric">{{ (trip.trip_duration_sec / 60) | number:'1.0-0' }} min</td>
            <td class="money">{{ trip.total_amount | currency }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button 
          (click)="onPageChange(currentPage - 1)" 
          [disabled]="currentPage === 1"
          class="btn-page"
        >
          â† Previous
        </button>
        
        <span class="page-info">
          Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
        </span>
        
        <button 
          (click)="onPageChange(currentPage + 1)" 
          [disabled]="currentPage === totalPages"
          class="btn-page"
        >
          Next â†’
        </button>
      </div>
    </div>
  </div>
</div>

<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <h1>üöï NYC TLC Trip Analytics</h1>
    <button class="btn-logout" (click)="logout()">Logout</button>
  </header>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label>Start Date:</label>
      <input 
        type="date" 
        [(ngModel)]="startDate" 
        (change)="onFilterChange()"
      />
    </div>

    <div class="filter-group">
      <label>End Date:</label>
      <input 
        type="date" 
        [(ngModel)]="endDate" 
        (change)="onFilterChange()"
      />
    </div>

    <div class="filter-group">
      <label>Service Type:</label>
      <select [(ngModel)]="serviceType" (change)="onFilterChange()">
        <option value="">All</option>
        <option value="yellow">Yellow Taxi</option>
        <option value="green">Green Taxi</option>
        <option value="fhv">FHV</option>
        <option value="fhvhv">FHVHV</option>
      </select>
    </div>

    <button class="btn-primary" (click)="loadData()">Refresh</button>
  </div>

  <!-- Chart Section -->
  <div class="chart-section">
    <h2>üìä Daily Trip Volume - Time Series</h2>
    <div class="chart-container" *ngIf="!loadingChart">
      <canvas 
        baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="lineChartType"
      ></canvas>
    </div>
    <div class="loading" *ngIf="loadingChart">
      Loading chart data...
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-section">
    <h2>üìã Trip Records</h2>
    
    <div class="loading" *ngIf="loadingTable">
      <div class="spinner"></div>
      <p>Loading trip records...</p>
    </div>
    
    <div *ngIf="!loadingTable && trips.length === 0 && !tripError" class="empty-state">
      <p>No trip records found for selected filters.</p>
      <small>Try adjusting your date range or removing filters.</small>
    </div>
    
    <div *ngIf="tripError" class="alert-warning">
      <strong>‚ö†Ô∏è Unable to load trip records.</strong> {{ tripError }}
    </div>

    <div *ngIf="!loadingTable && trips.length > 0">
      <table class="trips-table">
        <thead>
          <tr>
            <th>Trip ID</th>
            <th>Service</th>
            <th>Pickup Time</th>
            <th>Pickup Location</th>
            <th>Dropoff Location</th>
            <th>Distance (mi)</th>
            <th>Duration (min)</th>
            <th>Fare ($)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trip of trips">
            <td>{{ trip.trip_id }}</td>
            <td>
              <span class="badge" [class]="'badge-' + trip.service_type">
                {{ trip.service_type }}
              </span>
            </td>
            <td>{{ trip.pickup_datetime | date:'short' }}</td>
            <td>
              <strong>{{ trip.pickup_borough }}</strong><br>
              <small>{{ trip.pickup_zone }}</small>
            </td>
            <td>
              <strong>{{ trip.dropoff_borough }}</strong><br>
              <small>{{ trip.dropoff_zone }}</small>
            </td>
            <td>{{ trip.trip_distance | number:'1.2-2' }}</td>
            <td>{{ (trip.trip_duration_sec / 60) | number:'1.0-0' }}</td>
            <td>{{ trip.total_amount | currency }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button 
          (click)="onPageChange(currentPage - 1)" 
          [disabled]="currentPage === 1"
          class="btn-page"
        >
          Previous
        </button>
        
        <span class="page-info">
          Page {{ currentPage }} of {{ totalPages }} 
          ({{ totalRecords | number }} records)
        </span>
        
        <button 
          (click)="onPageChange(currentPage + 1)" 
          [disabled]="currentPage === totalPages"
          class="btn-page"
        >
          Next
        </button>
      </div>
    </div>
  </div>
</div>